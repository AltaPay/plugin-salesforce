"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[589],{21066(e,t,r){r.d(t,{A:()=>z});var n=r(77810),s=r(34692),a=r(41863),i=r(16602),l=r(75826),o=r.n(l),d=r(92519),u=r(62539),c=r(12619),p=r(95170),m=r(11692),g=r(27821),f=r(46039),h=r(84319),b=r(35490),y=r(64180),v=r(10939),E=r(35527),_=r.n(E),A=r(83092),S=r(90727),I=r(17778),O=r(23254);const w=(0,i.YK)({required:{defaultMessage:[{type:0,value:"Required"}],id:"use_credit_card_fields.error.required"},cardNumberInvalid:{defaultMessage:[{type:0,value:"Please enter a valid card number."}],id:"use_credit_card_fields.error.valid_card_number"},nameInvalid:{defaultMessage:[{type:0,value:"Please enter a valid name."}],id:"use_credit_card_fields.error.valid_name"},dateInvalid:{defaultMessage:[{type:0,value:"Please enter a valid date."}],id:"use_credit_card_fields.error.valid_date"},codeInvalid:{defaultMessage:[{type:0,value:"Please enter a valid security code."}],id:"use_credit_card_fields.error.valid_security_code"},cardNumber:{defaultMessage:[{type:0,value:"Card Number"}],id:"use_credit_card_fields.label.card_number"},cardType:{defaultMessage:[{type:0,value:"Card Type"}],id:"use_credit_card_fields.label.card_type"},cardName:{defaultMessage:[{type:0,value:"Name on Card"}],id:"use_credit_card_fields.label.name"},expiryDate:{defaultMessage:[{type:0,value:"Expiration Date"}],id:"use_credit_card_fields.label.expiry"},securityCode:{defaultMessage:[{type:0,value:"Security Code"}],id:"use_credit_card_fields.label.security_code"}});var P=r(63560);function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach(function(t){(0,v.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const k=({form:e,prefix:t=""})=>{var r;const{formatMessage:a}=(0,s.A)(),[i,l]=(0,n.useState)(!1),o=function({form:{control:e,formState:{errors:t}},prefix:r=""}){const{formatMessage:n}=(0,s.A)();return{number:{name:`${r}number`,label:n(w.cardNumber),defaultValue:"",type:"text",autoComplete:"cc-number",rules:{required:n({defaultMessage:[{type:0,value:"Please enter your card number."}],id:"use_credit_card_fields.error.required_card_number"}),validate:e=>_().number(e).isValid||n(w.cardNumberInvalid)},error:t[`${r}number`],inputProps:{inputMode:"numeric"},control:e},cardType:{name:`${r}cardType`,label:n(w.cardType),defaultValue:"",type:"hidden",error:t[`${r}cardType`],control:e},holder:{name:`${r}holder`,label:n(w.cardName),defaultValue:"",type:"text",autoComplete:"cc-name",rules:{required:n({defaultMessage:[{type:0,value:"Please enter your name as shown on your card."}],id:"use_credit_card_fields.error.required_name"}),validate:e=>_().cardholderName(e).isValid||n(w.nameInvalid)},error:t[`${r}holder`],control:e},expiry:{name:`${r}expiry`,label:n(w.expiryDate),defaultValue:"",type:"text",autoComplete:"cc-exp",placeholder:"MM/YY",rules:{required:n({defaultMessage:[{type:0,value:"Please enter your expiration date."}],id:"use_credit_card_fields.error.required_expiry"}),validate:e=>_().expirationDate(e).isValid||n(w.dateInvalid)},error:t[`${r}expiry`],inputProps:{inputMode:"numeric"},control:e},securityCode:{name:`${r}securityCode`,label:n(w.securityCode),defaultValue:"",type:"password",autoComplete:"off",rules:{required:n({defaultMessage:[{type:0,value:"Please enter your security code."}],id:"use_credit_card_fields.error.required_security_code"}),validate:e=>_().cvv(e).isValid||n(w.codeInvalid)},error:t[`${r}securityCode`],inputProps:({onChange:e})=>({inputMode:"numeric",maxLength:4,onChange(t){e(t.target.value.replace(/[^0-9 ]+/,""))}}),control:e}}}({form:e,prefix:t}),c=e.watch("cardType"),p=(0,O.N0)(e.getValues().cardType),g=a("american-express"===c?{id:"credit_card_fields.tool_tip.security_code.american_express",defaultMessage:[{type:0,value:"This 4-digit code can be found on the front of your card."}]}:{id:"credit_card_fields.tool_tip.security_code",defaultMessage:[{type:0,value:"This 3-digit code can be found on the back of your card."}]}),h=()=>{l(!1),document&&(document.removeEventListener("click",h),document.removeEventListener("keydown",h))},v=()=>{l(!0),document&&(document.addEventListener("click",h),document.addEventListener("keydown",h))};return n.createElement(u.az,null,n.createElement(d.B,{spacing:5},n.createElement(P.A,(0,y.A)({},o.number,{formLabel:n.createElement(m.s,{justify:"space-between"},n.createElement(A.l,null,o.number.label),n.createElement(d.B,{direction:"row",spacing:1},n.createElement(b.nL,{layerStyle:"ccIcon"}),n.createElement(b.uI,{layerStyle:"ccIcon"}),n.createElement(b.Nx,{layerStyle:"ccIcon"}),n.createElement(b.BP,{layerStyle:"ccIcon"}))),inputProps:({onChange:t})=>M(M({},o.number.inputProps),{},{onChange(r){const n=r.target.value.replace(/[^0-9 ]+/,""),{card:s}=_().number(n),a=s?(0,O.OE)(n,s):n;return e.setValue("cardType",(null==s?void 0:s.type)||""),t(a)}})}),p&&(null===(r=e.getValues().number)||void 0===r?void 0:r.length)>2&&n.createElement(S.t,{width:"60px"},n.createElement(p,{layerStyle:"ccIcon"}))),n.createElement(P.A,o.holder),n.createElement(I.r,{columns:[2,2,3],spacing:5},n.createElement(P.A,(0,y.A)({},o.expiry,{inputProps:({onChange:e})=>M(M({},o.expiry.inputProps),{},{onChange(t){let r=t.target.value.replace("/","");if(!(r.match(/[^\d|/]/g)||r.length>4))return r.length>=2&&(r=`${r.substr(0,2)}/${r.substr(2)}`),e(r)},onKeyDown(t){if(8===t.keyCode||46===t.keyCode)return t.preventDefault(),e(t.target.value.slice(0,-1))}})})),n.createElement(P.A,(0,y.A)({},o.securityCode,{formLabel:n.createElement(n.Fragment,null,n.createElement(A.l,{display:"inline",mr:1},o.securityCode.label),n.createElement(u.az,{onMouseEnter:v,onFocus:v,as:"span"},n.createElement(f.m,{hasArrow:!0,placement:"top",label:g,shouldWrapChildren:!0,isOpen:i},n.createElement(b.mo,{boxSize:5,color:"gray.700","aria-label":a({id:"credit_card_fields.tool_tip.security_code_aria_label",defaultMessage:[{type:0,value:"Security code info"}]})}))))})))),n.createElement(P.A,o.cardType))};k.propTypes={form:o().object.isRequired,prefix:o().string};const x=k;var j=r(79060);const T=({form:e,onSubmit:t})=>{const{formatMessage:r}=(0,s.A)(),{data:l}=(0,h.X)(),{currency:o}=(0,j.H2)();return n.createElement("form",{onSubmit:e.handleSubmit(t)},n.createElement(d.B,{spacing:8},n.createElement(d.B,{spacing:5},n.createElement(u.az,{border:"1px solid",borderColor:"gray.100",rounded:"base",overflow:"hidden"},n.createElement(c.z,{value:"cc","aria-label":r({defaultMessage:[{type:0,value:"Payment"}],id:"payment_selection.radio_group.assistive_msg"}),name:"payment-selection"},n.createElement(u.az,{py:3,px:[4,4,6],bg:"gray.50",borderBottom:"1px solid",borderColor:"gray.100"},n.createElement(p.s,{value:"cc"},n.createElement(m.s,{justify:"space-between"},n.createElement(d.B,{direction:"row",align:"center"},n.createElement(g.E,{fontWeight:"bold"},n.createElement(a.A,{defaultMessage:[{type:0,value:"Credit Card"}],id:"payment_selection.heading.credit_card"})),n.createElement(f.m,{hasArrow:!0,placement:"top",label:r({defaultMessage:[{type:0,value:"This is a secure SSL encrypted payment."}],id:"payment_selection.tooltip.secure_payment"})},n.createElement(b.XA,{color:"gray.700",boxSize:5}))),n.createElement(g.E,{fontWeight:"bold"},n.createElement(i.Gr,{value:null==l?void 0:l.orderTotal,style:"currency",currency:o}))))),n.createElement(u.az,{p:[4,4,6],borderBottom:"1px solid",borderColor:"gray.100"},n.createElement(d.B,{spacing:6},n.createElement(d.B,{spacing:6},n.createElement(x,{form:e})))),n.createElement(u.az,{py:3,px:[4,4,6],bg:"gray.50",borderColor:"gray.100"},n.createElement(p.s,{value:"paypal"},n.createElement(u.az,{py:"2px"},n.createElement(b.xt,{width:"auto",height:"20px"})))))))))};T.propTypes={form:o().object,onSubmit:o().func};const z=T},48860(e,t,r){r.r(t),r.d(t,{default:()=>At});var n=r(28407),s=r(77810),a=r(34692),i=r(41863),l=r(62539),o=r(91311),d=r(79237),u=r(3253),c=r(65602),p=r(92519),m=r(85771),g=r(51279),f=r(95266),h=r(7711),b=r(77167),y=r(64180),v=r(75826),E=r.n(v),_=r(27821),A=r(63177),S=r(41539),I=r(49632),O=r(28287),w=r(92769),P=r(49785),C=r(98398),M=r(19891),k=r(63560),x=r(59247),j=r(74653);const T=({form:e,handlePasswordlessLoginClick:t,isSocialEnabled:r,isPasswordlessEnabled:n,idps:a,showPasswordField:l,togglePasswordField:o})=>{const[d,u]=(0,s.useState)(!0);return r||n?d?s.createElement(s.Fragment,null,s.createElement(x.c,null),s.createElement(_.E,{align:"center",fontSize:"sm",marginTop:2,marginBottom:2},s.createElement(i.A,{defaultMessage:[{type:0,value:"Or Login With"}],id:"contact_info.message.or_login_with"})),n&&s.createElement(f.$,{variant:"outline",borderColor:"gray.500",type:"button",onClick:e=>{t(e)},isLoading:e.formState.isSubmitting},s.createElement(i.A,{defaultMessage:[{type:0,value:"Secure Link"}],id:"contact_info.button.secure_link"})),!l&&s.createElement(f.$,{variant:"outline",borderColor:"gray.500",onClick:()=>{o(),u(!d)}},s.createElement(i.A,{defaultMessage:[{type:0,value:"Password"}],id:"contact_info.button.password"})),r&&a&&s.createElement(j.A,{form:e,idps:a})):s.createElement(f.$,{variant:"outline",borderColor:"gray.500",onClick:()=>{o(),u(!d)}},s.createElement(i.A,{defaultMessage:[{type:0,value:"Back to Sign In Options"}],id:"contact_info.button.back_to_sign_in_options"})):s.createElement(f.$,{variant:"outline",borderColor:"gray.500",onClick:o},l?s.createElement(i.A,{defaultMessage:[{type:0,value:"Checkout as Guest"}],id:"contact_info.button.checkout_as_guest"}):s.createElement(i.A,{defaultMessage:[{type:0,value:"Already have an account? Log in"}],id:"contact_info.button.already_have_account"}))};T.propTypes={form:E().object,handlePasswordlessLoginClick:E().func,isSocialEnabled:E().bool,isPasswordlessEnabled:E().bool,idps:E().arrayOf(E().string),showPasswordField:E().bool,togglePasswordField:E().func};const z=T;var R=r(16423),N=r(60309),D=r(84319),B=r(65693),L=r(97361),q=r(90031),F=r(4026),$=r(40320),G=r(73448);const W=({isSocialEnabled:e=!1,isPasswordlessEnabled:t=!1,idps:r=[]})=>{var o,u,c,v;const{formatMessage:E}=(0,a.A)(),A=(0,h.A)(),{data:S}=(0,N.J)(),{data:I}=(0,D.X)(),O=(0,L.$)(),w=(0,q.useAuthHelper)(q.AuthHelpers.LoginRegisteredUserB2C),x=(0,q.useAuthHelper)(q.AuthHelpers.Logout),j=(0,q.useAuthHelper)(q.AuthHelpers.AuthorizePasswordless),T=(0,q.useShopperBasketsMutation)("updateCustomerForBasket"),W=(0,q.useShopperBasketsMutation)("mergeBasket"),{step:V,STEPS:U,goToStep:K,goToNextStep:Q}=(0,b.Q)(),X=(0,P.mN)({defaultValues:{email:(null==S?void 0:S.email)||(null==I||null===(o=I.customerInfo)||void 0===o?void 0:o.email)||"",password:""}}),Y=(0,C.A)({form:X}),J=(0,s.useRef)(),[Z,ee]=(0,s.useState)(null),[te,re]=(0,s.useState)(!1),[ne,se]=(0,s.useState)(!1),[ae,ie]=(0,s.useState)(R.aK),le=(0,R.Xi)(ae),oe=null===(u=(0,F.getConfig)().app.login)||void 0===u||null===(c=u.passwordless)||void 0===c?void 0:c.callbackURI,de=(0,B.n)(oe)?oe:`${O}${(0,$.getEnvBasePath)()}${oe}`,ue=function(){var e=(0,n.A)(function*(e){try{const t=window.location.pathname+(window.location.search||"");yield j.mutateAsync({userid:e,callbackURI:`${de}?redirectUrl=${t}`}),ie(R.fX),le.onOpen()}catch(e){const t=G.Fk.some(t=>t.test(e.message))?E(G.vn):E(G.gS);ee(t)}});return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=(0,n.A)(function*(e){ee(null);try{var t;if(e.password)yield w.mutateAsync({username:e.email,password:e.password}),(null===(t=I.productItems)||void 0===t?void 0:t.length)>0&&W.mutate({parameters:{createDestinationBasket:!0}});else yield T.mutateAsync({parameters:{basketId:I.basketId},body:{email:e.email}});Q()}catch(e){/Unauthorized/i.test(e.message)?ee(E({defaultMessage:[{type:0,value:"Incorrect username or password, please try again."}],id:"contact_info.error.incorrect_username_or_password"})):ee(e.message)}});return function(t){return e.apply(this,arguments)}}();(0,s.useEffect)(()=>{te||X.unregister("password")},[te]);const pe=function(){var e=(0,n.A)(function*(e){const t=yield X.trigger("email"),r=e.target.closest("form");if(t&&r.checkValidity()){const e=X.getValues().email;yield ue(e)}else r.reportValidity()});return function(t){return e.apply(this,arguments)}}();return s.createElement(M.Le,{id:"step-0",title:E({defaultMessage:[{type:0,value:"Contact Info"}],id:"contact_info.title.contact_info"}),editing:V===U.CONTACT_INFO,isLoading:X.formState.isSubmitting,onEdit:()=>{S.isRegistered?se(!0):K(U.CONTACT_INFO)},editLabel:S.isRegistered?E({defaultMessage:[{type:0,value:"Sign Out"}],id:"contact_info.action.sign_out"}):E({defaultMessage:[{type:0,value:"Edit Contact Info"}],id:"toggle_card.action.editContactInfo"})},s.createElement(M.hl,null,s.createElement(d.m,{variant:"form"},s.createElement("form",{onSubmit:X.handleSubmit(ce)},s.createElement(p.B,{spacing:6},Z&&s.createElement(m.F,{status:"error"},s.createElement(g._,null),Z),s.createElement(p.B,{spacing:5,position:"relative"},s.createElement(k.A,(0,y.A)({},Y.email,{inputRef:J})),te&&s.createElement(p.B,null,s.createElement(k.A,Y.password),s.createElement(l.az,null,s.createElement(f.$,{variant:"link",size:"sm",onClick:()=>{ie(R.aK),le.onOpen()}},s.createElement(i.A,{defaultMessage:[{type:0,value:"Forgot password?"}],id:"contact_info.link.forgot_password"}))))),s.createElement(p.B,{spacing:3},s.createElement(f.$,{type:"submit"},te?s.createElement(i.A,{defaultMessage:[{type:0,value:"Log In"}],id:"contact_info.button.login"}):s.createElement(i.A,{defaultMessage:[{type:0,value:"Checkout as Guest"}],id:"contact_info.button.checkout_as_guest"})),s.createElement(z,{form:X,isSocialEnabled:e,isPasswordlessEnabled:t,idps:r,showPasswordField:te,togglePasswordField:()=>{Z&&ee(null),re(!te),J.current&&J.current.focus()},handlePasswordlessLoginClick:pe}))))),s.createElement(R.Ux,(0,y.A)({},le,{initialEmail:X.getValues().email}))),s.createElement(M.vr,null,s.createElement(_.E,null,(null==I||null===(v=I.customerInfo)||void 0===v?void 0:v.email)||(null==S?void 0:S.email)),s.createElement(H,{isOpen:ne,onClose:()=>se(!1),onConfirm:(0,n.A)(function*(){yield x.mutateAsync(),A("/login"),se(!1)})})))};W.propTypes={isSocialEnabled:E().bool,isPasswordlessEnabled:E().bool,idps:E().arrayOf(E().string)};const H=({isOpen:e,onConfirm:t,onClose:r})=>{const n=(0,s.useRef)();return s.createElement(A.L,{isOpen:e,leastDestructiveRef:n,onClose:r},s.createElement(S.m,null,s.createElement(A.E,null,s.createElement(I.r,{fontSize:"lg",fontWeight:"bold"},s.createElement(i.A,{defaultMessage:[{type:0,value:"Sign Out"}],id:"signout_confirmation_dialog.heading.sign_out"})),s.createElement(O.c,null,s.createElement(i.A,{defaultMessage:[{type:0,value:"Are you sure you want to sign out? You will need to sign back in to proceed with your current order."}],id:"signout_confirmation_dialog.message.sure_to_sign_out"})),s.createElement(w.j,null,s.createElement(f.$,{ref:n,variant:"outline",onClick:r},s.createElement(i.A,{defaultMessage:[{type:0,value:"Cancel"}],id:"signout_confirmation_dialog.button.cancel"})),s.createElement(f.$,{colorScheme:"red",onClick:t,ml:3},s.createElement(i.A,{defaultMessage:[{type:0,value:"Sign Out"}],id:"signout_confirmation_dialog.button.sign_out"}))))))};H.propTypes={isOpen:E().bool,onClose:E().func,onConfirm:E().func};const V=W;var U=r(10939),K=r(11692),Q=r(70581),X=r(23132),Y=r(82926),J=r(90788),Z=r(56344),ee=r(20918),te=r(45040),re=r(79060),ne=r(2702);function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach(function(t){(0,U.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const ie=({products:e,productsByItemId:t,currency:r,title:n})=>e&&0!==e.length?s.createElement(p.B,{spacing:4},n&&s.createElement(l.az,{mt:3,mb:2},s.createElement(_.E,{fontWeight:"bold",fontSize:"sm",color:"gray.600"},n)),e.map(e=>{const n=ae(ae({},e),t&&t[e.itemId]);return s.createElement(Q.A,{key:e.itemId,variant:n},s.createElement(l.az,{border:"1px solid",borderColor:"gray.200",borderRadius:"md",p:3,bg:"white"},s.createElement(K.s,{width:"full",alignItems:"flex-start"},s.createElement(X.A,{width:["88px","136px"],mr:4}),s.createElement(p.B,{spacing:1,marginTop:"-3px",flex:1},s.createElement(Y.A,null),s.createElement(J.A,{includeQuantity:!1,hideAttributeLabels:!0}),s.createElement(K.s,{width:"full",justifyContent:"space-between",alignItems:"flex-end"},s.createElement(_.E,{fontSize:"sm",color:"gray.700"},s.createElement(i.A,{defaultMessage:[{type:0,value:"Qty: "},{type:1,value:"quantity"}],values:{quantity:e.quantity},id:"item_attributes.label.quantity_abbreviated"})),s.createElement(Z.A,{currency:r}))))))})):null;ie.propTypes={products:E().arrayOf(E().shape({itemId:E().string.isRequired,productId:E().string.isRequired,productName:E().string.isRequired,quantity:E().number.isRequired,priceAfterItemDiscount:E().number.isRequired,variationValues:E().object})),productsByItemId:E().object,currency:E().string,title:E().oneOfType([E().string,E().element])};const le=()=>{var e,t,r,n;const{formatMessage:o}=(0,a.A)(),{step:u,STEPS:c,goToStep:m,goToNextStep:g}=(0,b.Q)(),{data:h,derivedData:y}=(0,D.X)(),v=(null===(e=(0,F.getConfig)())||void 0===e||null===(t=e.app)||void 0===t?void 0:t.storeLocatorEnabled)??G.mP,{currency:E}=(0,re.H2)(),A=(null==y?void 0:y.totalPickupShipments)>0,S=(null==y?void 0:y.totalDeliveryShipments)>0,I=(null==y||null===(r=y.pickupStoreIds)||void 0===r?void 0:r.join(","))??"",{selectedStore:O}=(0,te.I)(),w=(null==O?void 0:O.inventoryId)||null,P=(null==h||null===(n=h.productItems)||void 0===n?void 0:n.map(({productId:e})=>e).join(","))??"",{data:C}=(0,q.useProducts)({parameters:ae({ids:P,allImages:!0,perPricebook:!0},w?{inventoryIds:w}:{})},{enabled:Boolean(P),select:e=>{var t;return null==e||null===(t=e.data)||void 0===t?void 0:t.reduce((e,t)=>(e[t.id]=t,e),{})}}),{data:k,isLoading:j}=(0,q.useStores)({parameters:{ids:I}},{enabled:v&&!!I}),T=(0,s.useMemo)(()=>{var e;const t={};return null==h||null===(e=h.productItems)||void 0===e||e.forEach(e=>{const r=null==C?void 0:C[null==e?void 0:e.productId];t[e.itemId]=r}),t},[h,C]),z=(0,s.useMemo)(()=>{if(null==h||!h.shipments||null==h||!h.productItems)return[];const e=[];return h.shipments.forEach(t=>{if(v&&(0,ne.f_)(t)){var r,n;const s=null==t?void 0:t.c_fromStoreId,a=null==k||null===(r=k.data)||void 0===r?void 0:r.find(e=>e.id===s),i=((null===(n=h.productItems)||void 0===n?void 0:n.filter(e=>e.shipmentId===t.shipmentId))||[]).reduce((e,t)=>(t.bonusProductLineItem?e.bonusProducts.push(t):e.regularProducts.push(t),e),{regularProducts:[],bonusProducts:[]});e.push({shipment:t,store:a,regularProducts:i.regularProducts,bonusProducts:i.bonusProducts})}}),e},[null==h?void 0:h.shipments,null==h?void 0:h.productItems,null==k?void 0:k.data]),R=z.length>1||S;if(!A)return null;const N=z.length>0&&!j;return s.createElement(M.Le,{id:"step-1",title:o({defaultMessage:[{type:0,value:"Pickup Address & Information"}],id:"pickup_address.title.pickup_address"}),editing:u===c.PICKUP_ADDRESS,disabled:u===c.CONTACT_INFO,onEdit:()=>m(c.PICKUP_ADDRESS),editLabel:o({defaultMessage:[{type:0,value:"Show Products"}],id:"pickup_address.button.show_products"})},u===c.PICKUP_ADDRESS&&s.createElement(s.Fragment,null,z.length>0&&!j&&s.createElement(s.Fragment,null,s.createElement(p.B,{spacing:6},z.map((e,t)=>{var r,n;return s.createElement(l.az,{key:`pickup-${null===(r=e.shipment)||void 0===r?void 0:r.shipmentId}-${(null===(n=e.store)||void 0===n?void 0:n.id)||t}`,border:"1px solid",borderColor:"gray.200",borderRadius:"md",p:4,mb:4},s.createElement(_.E,{fontWeight:"bold",fontSize:"md",mb:2},s.createElement(i.A,{defaultMessage:[{type:0,value:"Store Information"}],id:"pickup_address.title.store_information"})),e.store&&s.createElement(l.az,{mb:4},s.createElement(ee.A,{store:e.store,showDistance:!0,showStoreHours:!0,showPhone:!0,showEmail:!0,nameStyle:{fontSize:"sm",fontWeight:"normal"},textSize:"sm"})),s.createElement(ie,{products:e.regularProducts,productsByItemId:T,currency:E}),s.createElement(ie,{products:e.bonusProducts,productsByItemId:T,currency:E,title:s.createElement(i.A,{defaultMessage:[{type:0,value:"Bonus Items"}],id:"pickup_address.bonus_products.title"})}))}))),s.createElement(l.az,{pt:3},s.createElement(d.m,{variant:"form"},s.createElement(f.$,{w:"full",onClick:()=>g()},S?s.createElement(i.A,{defaultMessage:[{type:0,value:"Continue to Shipping Address"}],id:"pickup_address.button.continue_to_shipping_address"}):s.createElement(i.A,{defaultMessage:[{type:0,value:"Continue to Payment"}],id:"pickup_address.button.continue_to_payment"}))))),N&&s.createElement(M.vr,null,z.length>0&&z[0].store&&s.createElement(s.Fragment,null,1===z.length&&!R&&s.createElement(s.Fragment,null,s.createElement(_.E,{fontWeight:"bold",fontSize:"md",mb:2},s.createElement(i.A,{defaultMessage:[{type:0,value:"Store Information"}],id:"pickup_address.title.store_information"})),s.createElement(ee.A,{store:z[0].store,showDistance:!0,showStoreHours:!0,showPhone:!0,showEmail:!0,nameStyle:{fontSize:"sm",fontWeight:"normal"},textSize:"sm"})),R&&s.createElement(p.B,{spacing:4},z.map((e,t)=>{var r,n;return s.createElement(l.az,{key:`pickup-summary-${null===(r=e.shipment)||void 0===r?void 0:r.shipmentId}-${(null===(n=e.store)||void 0===n?void 0:n.id)||t}`},s.createElement(_.E,{fontWeight:"bold",fontSize:"md",mb:2},s.createElement(i.A,{defaultMessage:[{type:0,value:"Store Information"}],id:"pickup_address.title.store_information"})),e.store&&s.createElement(ee.A,{store:e.store,showDistance:!1,showStoreHours:!1,showPhone:!1,showEmail:!1,nameStyle:{fontSize:"sm",fontWeight:"normal"},textSize:"sm"}),t<z.length-1&&s.createElement(x.c,{my:4}))})))))};var oe=r(27869),de=r(16602),ue=r(75002),ce=r(63484),pe=r(73437),me=r(65772),ge=r(34638),fe=r(77638),he=r(50350),be=r(39909),ye=r(27107),ve=r(18222);function Ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(r),!0).forEach(function(t){(0,U.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ee(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(r),!0).forEach(function(t){(0,U.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ae(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const Ie=(e,t,r,i,l)=>{const{formatMessage:o}=(0,a.A)(),d=(0,ge.d)(),{data:u,refetch:c}=(0,N.J)(),[p,m]=(0,s.useState)({}),g=(0,q.useShopperCustomersMutation)("createCustomerAddress"),f=(0,P.mN)({mode:"onSubmit",defaultValues:{firstName:"",lastName:"",phone:"",countryCode:"US",address1:"",city:"",stateCode:"",postalCode:"",preferred:!1}}),h=(0,s.useMemo)(()=>{var e;return(null===(e=Object.keys(p).filter(e=>p[e]))||void 0===e?void 0:e.length)>0},[p]),b=(0,s.useCallback)(function(){var s=(0,n.A)(function*(n,s){try{if(i.some(e=>(0,ve.t4)(n,e)))return d({title:o({id:"shipping_multi_address.error.duplicate_address",defaultMessage:[{type:0,value:"The address you entered already exists."}]}),status:"info"}),m(e=>Se(Se({},e),{},{[s]:!1})),f.reset(),f.clearErrors(),null;let a;if(t)a=e(n);else{const e=Se(Se({},(0,ve.ux)(n)),{},{addressId:`addr_${(0,oe.Ak)()}`}),t=yield g.mutateAsync({body:e,parameters:{customerId:u.customerId}});yield c(),a=t}if(d({title:o({id:"shipping_multi_address.success.address_saved",defaultMessage:[{type:0,value:"Address saved successfully"}]}),status:"success"}),0===i.length){const e=l.map(e=>e.itemId);r(e,a.addressId)}else r(s,a.addressId);return m(e=>Se(Se({},e),{},{[s]:!1})),f.reset(),f.clearErrors(),a}catch(e){d({title:o({id:"shipping_multi_address.error.save_failed",defaultMessage:[{type:0,value:"Couldn't save the address."}]}),status:"error"})}});return function(e,t){return s.apply(this,arguments)}}(),[t,e,null==u?void 0:u.customerId,r,i,l]),y=(0,s.useCallback)(e=>{m(t=>Se(Se({},t),{},{[e]:!0}))},[]),v=(0,s.useCallback)(e=>{m(t=>Se(Se({},t),{},{[e]:!1})),f.clearErrors()},[f]);return{form:f,formStateByItemId:p,isSubmitting:f.formState.isSubmitting,openForm:y,closeForm:v,handleCreateAddress:b,isAddressFormOpen:h,formErrors:f.formState.errors}};var Oe=r(38446),we=r(55462),Pe=r(46378),Ce=r(87375),Me=r(10881),ke=r(61740),xe=r(74941),je=r(80460),Te=r(16256),ze=r(81916);const Re=({variant:e,includeQuantity:t=!0})=>{const{formatMessage:r}=(0,a.A)(),n=(null==e?void 0:e.variationAttributes)||[],i=(null==e?void 0:e.variationValues)||{};return s.createElement(we.B8,{spacing:1.5,flex:1,"aria-label":r({id:"shipping_multi_address.product_attributes.label",defaultMessage:[{type:0,value:"Product attributes"}]})},n&&n.length>0&&n.map(e=>{var t;const r=null===(t=e.values)||void 0===t?void 0:t.find(t=>t.value===i[e.id]);return s.createElement(we.ck,{key:e.id},s.createElement(_.E,{lineHeight:1,color:"gray.700",fontSize:"sm"},e.name||e.id,": ",(null==r?void 0:r.name)||(null==r?void 0:r.value)||""))}),t&&s.createElement(we.ck,null,s.createElement(_.E,{lineHeight:1,color:"gray.700",fontSize:"sm"},r({id:"shipping_multi_address.quantity.label",defaultMessage:[{type:0,value:"Quantity"}]}),": ",e.quantity)))};Re.propTypes={variant:E().object.isRequired,includeQuantity:E().bool};const Ne=({item:e,form:t,onSubmit:r,onCancel:a})=>{var i;const o=(0,de.zR)({defaultMessage:[{type:0,value:"Save"}],id:"shipping_address_form.button.save"});return s.createElement(l.az,{position:"relative",bg:"white",padding:6,width:"100%"},t.formState.isSubmitting&&s.createElement(ke.A,null),s.createElement("form",{"data-testid":"address-form",onSubmit:t.handleSubmit(function(){var s=(0,n.A)(function*(n){yield r(n,t,e.itemId)});return function(e){return s.apply(this,arguments)}}())},s.createElement(p.B,{spacing:6,width:"100%"},(null===(i=t.formState.errors)||void 0===i?void 0:i.global)&&s.createElement(m.F,{status:"error"},s.createElement(g._,{color:"red.600",boxSize:4}),s.createElement(ye.T,null,t.formState.errors.global.message)),s.createElement(Te.A,{form:t}),s.createElement(ze.A,{onCancel:a,saveButtonLabel:o}))))};Ne.propTypes={item:E().object.isRequired,form:E().object.isRequired,onSubmit:E().func.isRequired,onCancel:E().func.isRequired};const De=({item:e,variant:t,imageUrl:r,addressKey:n,selectedAddressId:i,availableAddresses:o,isGuestUser:d,customerLoading:u,onAddressSelect:c,onAddNewAddress:p,showAddAddressForm:m,addressForm:g,handleCreateAddress:h,closeForm:b})=>{const{formatMessage:y}=(0,a.A)(),{currency:v}=(0,re.H2)();return s.createElement(l.az,{key:n,border:"1px solid",borderColor:"gray.200",borderRadius:"md",p:2,"data-testid":"multi-shipping-card",w:"100%",flex:"1"},s.createElement(K.s,{direction:{base:"column",md:"row"},align:"flex-start",w:"100%",h:"100%",gap:{base:4,md:6}},s.createElement(K.s,{direction:"row",align:"flex-start",flex:1,minW:0},s.createElement(Pe.z,{align:"flex-start",spacing:3,w:"100%"},s.createElement(l.az,{flexShrink:0,borderRadius:"md",bg:"gray.100",overflow:"hidden",position:"relative",maxW:{base:"60px",md:"80px"},w:"100%",aspectRatio:"1"},s.createElement(Ce._,{src:r,alt:y({id:"shipping_multi_address.image.alt",defaultMessage:[{type:0,value:"Product image for "},{type:1,value:"productName"}]},{productName:e.productName}),objectFit:"cover",w:"100%",h:"100%"})),s.createElement(Q.A,{variant:t},s.createElement(he.T,{justify:"flex-start",minW:0,flex:1,pt:0,align:"flex-start"},s.createElement(_.E,{id:`product-title-${n}`,"data-testid":`product-title-${n}`,fontWeight:"medium",fontSize:{base:"sm",md:"md"},mb:1,color:"gray.900",textAlign:"left"},e.productName),s.createElement(l.az,{id:`product-description-${n}`,"data-testid":`product-description-${n}`},s.createElement(Re,{variant:t,includeQuantity:!0})))))),s.createElement(he.T,{align:"flex-start",w:"100%",flex:{base:"none",md:"1"},minW:{base:"100%",md:"280px"},maxW:{base:"100%",md:"400px"},pt:0,spacing:1,mt:{base:4,md:0}},s.createElement(_.E,{id:`delivery-address-label-${n}`,"data-testid":`delivery-address-label-${n}`,fontWeight:"medium",fontSize:"sm",mb:1},y({defaultMessage:[{type:0,value:"Delivery Address"}],id:"shipping_address.label.shipping_address"})),s.createElement(l.az,{w:"100%",mb:6},s.createElement(he.T,{spacing:3,align:"stretch"},!d&&u?s.createElement(l.az,{p:4,textAlign:"center"},s.createElement(_.E,{color:"gray.500"},y({id:"shipping_multi_address.loading_addresses",defaultMessage:[{type:0,value:"Loading addresses..."}]}))):s.createElement(Me.l,{value:i||"",onChange:e=>{const t=e.target.value;b(n),c(n,t)},disabled:0===o.length||!d&&u,"aria-labelledby":`delivery-address-label-${n}`,borderColor:"gray.300",_hover:{borderColor:"gray.400"},_focus:{borderColor:"blue.500",boxShadow:"0 0 0 1px var(--chakra-colors-blue-500)"},"data-testid":`address-dropdown-${n}`},0===o.length?s.createElement("option",{value:""},y({id:"shipping_multi_address.no_addresses_available",defaultMessage:[{type:0,value:"No address available"}]})):o.map(e=>s.createElement("option",{key:e.addressId,value:e.addressId,"data-testid":`address-option-${e.addressId}`},e.firstName," ",e.lastName," - ",e.address1,","," ",y({id:"shipping_multi_address.format.address_line_2",defaultMessage:[{type:1,value:"city"},{type:0,value:", "},{type:1,value:"stateCode"},{type:0,value:" "},{type:1,value:"postalCode"}]},{city:e.city,stateCode:e.stateCode||"",postalCode:e.postalCode})))),s.createElement(f.$,{variant:"link",size:"sm",onClick:()=>{p(n)},alignSelf:"flex-start","aria-label":y({id:"shipping_multi_address.add_new_address.aria_label",defaultMessage:[{type:0,value:"Add new delivery address for "},{type:1,value:"productName"}]},{productName:e.productName})},y({defaultMessage:[{type:0,value:"+ Add New Address"}],id:"shipping_address.button.add_new_address"})))),s.createElement(l.az,{fontWeight:"semibold",fontSize:"md",color:"gray.900",alignSelf:"flex-end",mt:"auto"},s.createElement(je.A,{priceData:(0,xe.mY)(t),currency:v,labelForA11y:t.productName})))),m[n]&&s.createElement(l.az,{position:"relative",mt:4,width:"100%"},s.createElement(Ne,{item:e,form:g,onSubmit:(e,t,r)=>h(e,r),onCancel:()=>b(n)})))};De.displayName="ProductShippingAddressCard",De.propTypes={item:E().object.isRequired,variant:E().object.isRequired,imageUrl:E().string.isRequired,addressKey:E().string.isRequired,selectedAddressId:E().string,availableAddresses:E().array.isRequired,isGuestUser:E().bool.isRequired,customerLoading:E().bool.isRequired,onAddressSelect:E().func.isRequired,onAddNewAddress:E().func.isRequired,showAddAddressForm:E().object.isRequired,addressForm:E().object.isRequired,handleCreateAddress:E().func.isRequired,closeForm:E().func.isRequired};const Be=De;function Le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(r),!0).forEach(function(t){(0,U.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Le(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const Fe=({basket:e,submitButtonLabel:t,noItemsInBasketMessage:r,onUnsavedGuestAddressesToggleWarning:i})=>{const{formatMessage:o}=(0,a.A)(),{STEPS:d,goToStep:u}=(0,b.Q)(),c=(0,ge.d)(),p=(e=>{var t,r,n;const{data:a}=(0,N.J)(),i=(0,s.useMemo)(()=>{var t;return(null==e||null===(t=e.productItems)||void 0===t?void 0:t.filter(t=>{var r;const n=null==e||null===(r=e.shipments)||void 0===r?void 0:r.find(e=>e.shipmentId===t.shipmentId);return!(0,ne.gF)(null==n?void 0:n.shippingMethod)}))||[]},[null==e?void 0:e.productItems,null==e?void 0:e.shipments]),[l,o]=(0,s.useState)([]),[d,u]=(0,s.useState)({}),[c,p]=(0,s.useState)({}),m=(0,s.useRef)(!1),g=(0,s.useMemo)(()=>null!=a&&a.isGuest?l:(null==a?void 0:a.addresses)||[],[a,l]);(0,s.useEffect)(()=>{if(null!=a&&a.customerId&&null!=a&&a.isRegistered&&(null==i?void 0:i.length)>0&&g.length>0){var t;const r={},n=(null==e||null===(t=e.shipments)||void 0===t?void 0:t.filter(e=>e.shippingAddress&&!(0,ne.gF)(null==e?void 0:e.shippingMethod)))||[];n.length>0?i.forEach(e=>{const t=e.itemId,s=n.find(t=>t.shipmentId===e.shipmentId);if(s&&s.shippingAddress){const e=g.find(e=>(0,ve.t4)(e,s.shippingAddress));e?r[t]=e.addressId:g.length>0&&(r[t]=g[0].addressId)}else if(g.length>0){const e=g.find(e=>e.preferred)||g[0];e&&(r[t]=e.addressId)}}):g.length>0&&i.forEach(e=>{const t=e.itemId,n=g.find(e=>e.preferred)||g[0];n&&(r[t]=n.addressId)}),Object.keys(r).length>0&&p(e=>{const t=_e({},e);let n=!1;return i.forEach(s=>{const a=s.itemId;!e[a]&&r[a]&&(t[a]=r[a],n=!0)}),n?t:e})}},[null==a?void 0:a.customerId,null==a?void 0:a.isGuest,g.length,null==e||null===(t=e.shipments)||void 0===t?void 0:t.length,null==i?void 0:i.length]),(0,s.useEffect)(()=>{if(null!=a&&a.isGuest&&(null==i?void 0:i.length)>0&&!m.current){var t;const r=(null==e||null===(t=e.shipments)||void 0===t?void 0:t.filter(e=>e.shippingAddress&&!(0,ne.gF)(null==e?void 0:e.shippingMethod)))||[];if(r.length>0){const e=[],t={};i.forEach(n=>{const s=n.itemId,a=r.find(e=>e.shipmentId===n.shipmentId);if(a&&!(0,ve.Cg)(a.shippingAddress)){const r=[...l,...e].find(e=>(0,ve.t4)(e,a.shippingAddress));if(r)t[s]=r.addressId;else{const r=`guest_${n.itemId}`,i={addressId:r,firstName:a.shippingAddress.firstName,lastName:a.shippingAddress.lastName,address1:a.shippingAddress.address1,city:a.shippingAddress.city,stateCode:a.shippingAddress.stateCode,postalCode:a.shippingAddress.postalCode,countryCode:a.shippingAddress.countryCode,phone:a.shippingAddress.phone,isGuestAddress:!0,originalShipmentId:a.shipmentId};e.push(i),t[s]=r}}}),e.length>0&&o(t=>{const r=[...t,...e],n=[];return r.forEach(e=>{n.some(t=>(0,ve.t4)(e,t))||n.push(e)}),n}),Object.keys(t).length>0&&u(e=>_e(_e({},e),t)),m.current=!0}}},[null==a?void 0:a.isGuest,null==e||null===(r=e.productItems)||void 0===r?void 0:r.length,null==e||null===(n=e.shipments)||void 0===n?void 0:n.length]);const f=null!=a&&a.isGuest?d:c,h=(0,s.useCallback)((e,t)=>{const r=Array.isArray(e)?e:[e];null!=a&&a.isGuest?u(e=>{const n=_e({},e);return""===t?r.forEach(e=>{delete n[e]}):r.forEach(e=>{n[e]=t}),n}):p(e=>{const n=_e({},e);return""===t?r.forEach(e=>{delete n[e]}):r.forEach(e=>{n[e]=t}),n})},[null==a?void 0:a.isGuest]),b=(0,s.useCallback)(e=>{const t=_e(_e({},e),{},{addressId:`guest_${(0,oe.Ak)()}`,isGuestAddress:!0});return o(e=>[...e,t]),t},[]),y=(0,s.useMemo)(()=>{const e={};return i.forEach(t=>{const r=f[t.itemId],n=g.find(e=>e.addressId===r);n&&(e[t.itemId]=n)}),e},[i,f,g]),v=(0,s.useMemo)(()=>i.every(e=>y[e.itemId]),[i,y]);return{availableAddresses:g||[],selectedAddresses:f||{},addGuestAddress:b,setAddressesForItems:h,deliveryItems:i||[],allItemsHaveAddresses:v}})(e),h=p.deliveryItems.map(e=>e.productId).join(","),{data:y,isLoading:v,error:E}=(0,q.useProducts)({parameters:{ids:h,allImages:!0}},{enabled:Boolean(h),select:e=>{var t;return(null==e||null===(t=e.data)||void 0===t?void 0:t.reduce((e,t)=>(e[t.id]=t,e),{}))||{}}}),{data:A,isLoading:S}=(0,N.J)(),{form:I,formStateByItemId:O,isSubmitting:w,openForm:P,closeForm:C,handleCreateAddress:M,isAddressFormOpen:k}=Ie(p.addGuestAddress,null==A?void 0:A.isGuest,p.setAddressesForItems,p.availableAddresses,p.deliveryItems),{orchestrateShipmentOperations:x}=(0,Oe.n)(e),j=p.availableAddresses,[T,z]=(0,s.useState)(!1),R=(null==A||!A.isGuest)&&S||v,D=p.allItemsHaveAddresses,B=(0,s.useMemo)(()=>{var t,r,n;if(null==A||!A.isGuest||null==j||!j.length)return!1;const s=(null==e||null===(t=e.shipments)||void 0===t||null===(r=t.filter(e=>!(0,ne.f_)(e)))||void 0===r||null===(n=r.map(e=>e.shippingAddress))||void 0===n?void 0:n.filter(Boolean))||[];return j.length>s.length},[null==A?void 0:A.isGuest,j,null==e?void 0:e.shipments]);if((0,s.useEffect)(()=>{null==i||i(B)},[B,i]),!p.deliveryItems.length)return s.createElement(fe.o,{p:8,textAlign:"center",color:"gray.500",role:"status","aria-live":"polite","aria-label":o(r)},s.createElement(he.T,{spacing:4},s.createElement(_.E,{fontSize:"lg",fontWeight:"medium"},o(r))));if(E)return s.createElement(m.F,{status:"error",variant:"subtle",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",height:"200px","aria-live":"assertive"},s.createElement(g._,{boxSize:5,mr:0}),s.createElement(be.X,{mr:2},o({id:"shipping_multi_address.error.label",defaultMessage:[{type:0,value:"Something went wrong while loading products."}]})),s.createElement(ye.T,null,o({id:"shipping_multi_address.error.message",defaultMessage:[{type:0,value:"Something went wrong while loading products. Try again."}]})));if(R)return s.createElement(fe.o,{p:8,textAlign:"center",color:"gray.500"},s.createElement(he.T,{spacing:4},s.createElement(_.E,{fontSize:"lg",fontWeight:"medium"},o({id:"shipping_multi_address.loading.message",defaultMessage:[{type:0,value:"Loading..."}]}))));const L=function(){var e=(0,n.A)(function*(){z(!0);try{yield x(p.deliveryItems,p.selectedAddresses,j,y),u(d.SHIPPING_OPTIONS)}catch(e){c({title:o({defaultMessage:[{type:0,value:"Something went wrong while setting up shipments. Try again."}],id:"shipping_multi_address.error.submit_failed"}),status:"error"})}finally{z(!1)}});return function(){return e.apply(this,arguments)}}();return s.createElement(l.az,null,s.createElement(he.T,{spacing:0},s.createElement(l.az,{border:"1px solid",borderColor:"gray.200",borderRadius:"md",bg:"white",p:2,w:"100%"},s.createElement(he.T,{spacing:2,w:"100%",h:"100%"},p.deliveryItems.map(e=>{var t,r;const n=(null==y?void 0:y[e.productId])||{},a=qe(qe({},e),n),i=null===(t=(0,me.F)(n.imageGroups,{viewType:"small",selectedVariationAttributes:a.variationValues}))||void 0===t||null===(r=t.images)||void 0===r?void 0:r[0],l=(null==i?void 0:i.disBaseLink)||(null==i?void 0:i.link)||"",o=e.itemId;return s.createElement(Be,{key:o,item:e,variant:a,imageUrl:l,addressKey:o,selectedAddressId:p.selectedAddresses[o],availableAddresses:j,isGuestUser:null==A?void 0:A.isGuest,customerLoading:S,onAddressSelect:p.setAddressesForItems,onAddNewAddress:P,showAddAddressForm:O,addressForm:I,handleCreateAddress:M,closeForm:C})}))),s.createElement(f.$,{type:"button",width:"full",mt:2,opacity:!D||k?.8:1,cursor:!D||k?"not-allowed":"pointer",isLoading:I.formState.isSubmitting||w||T,isDisabled:!D||k,"data-testid":"continue-to-shipping-button",loadingText:o({id:"shipping_multi_address.submit.loading",defaultMessage:[{type:0,value:"Setting up shipments..."}]}),"aria-label":o({id:"shipping_multi_address.submit.description",defaultMessage:[{type:0,value:"Continue to next step with selected delivery addresses"}]}),onClick:()=>{!k&&D&&L()}},o(t))))};Fe.propTypes={basket:E().object.isRequired,submitButtonLabel:E().object.isRequired,noItemsInBasketMessage:E().object.isRequired,onUnsavedGuestAddressesToggleWarning:E().func};const $e=Fe;var Ge=r(4997);const We=(0,de.zR)({defaultMessage:[{type:0,value:"Switch to one address?"}],id:"multi_ship_warning_modal.title.switch_to_one_address"}),He=(0,de.zR)({defaultMessage:[{type:0,value:"If you switch to one address, the shipping addresses you added for the items will be removed."}],id:"multi_ship_warning_modal.message.addresses_will_be_removed"}),Ve=(0,de.zR)({defaultMessage:[{type:0,value:"Switch"}],id:"multi_ship_warning_modal.action.switch_to_one_address"}),Ue=(0,de.zR)({defaultMessage:[{type:0,value:"Cancel"}],id:"multi_ship_warning_modal.action.cancel"}),Ke=({isOpen:e,onClose:t,onConfirm:r,onCancel:n})=>{const{formatMessage:i}=(0,a.A)(),l=()=>{n(),t()};return s.createElement(A.L,{isOpen:e,isCentered:!0,onClose:l,closeOnEsc:!0,closeOnOverlayClick:!0},s.createElement(S.m,null),s.createElement(A.E,{maxW:"448px",w:"448px",minH:"196px",borderRadius:"6px"},s.createElement(I.r,null,i(We)),s.createElement(O.c,null,s.createElement(_.E,null,i(He))),s.createElement(w.j,null,s.createElement(f.$,{variant:"ghost",mr:3,onClick:l,"aria-label":i(Ue)},i(Ue)),s.createElement(f.$,{variant:"solid",onClick:()=>{r(),t()},"aria-label":i(Ve)},i(Ve)))))};Ke.propTypes={isOpen:E().bool.isRequired,onClose:E().func.isRequired,onConfirm:E().func.isRequired,onCancel:E().func.isRequired};const Qe=Ke;function Xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Ye(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(r),!0).forEach(function(t){(0,U.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xe(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const Je=(0,de.zR)({defaultMessage:[{type:0,value:"Continue to Shipping Method"}],id:"shipping_address.button.continue_to_shipping"}),Ze=(0,de.zR)({defaultMessage:[{type:0,value:"Shipping Address Form"}],id:"shipping_address.label.shipping_address_form"}),et=(0,de.zR)({defaultMessage:[{type:0,value:"No items in basket."}],id:"shipping_address.message.no_items_in_basket"}),tt=(0,de.zR)({defaultMessage:[{type:0,value:"Ship to Single Address"}],id:"shipping_address.action.ship_to_single_address"}),rt=(0,de.zR)({defaultMessage:[{type:0,value:"Ship to Multiple Addresses"}],id:"shipping_address.action.ship_to_multiple_addresses"});function nt(){var e,t,r,i;const{formatMessage:l}=(0,a.A)(),[o,d]=(0,s.useState)(),{data:u}=(0,N.J)(),{data:c}=(0,D.X)(),p=(null===(e=(0,F.getConfig)())||void 0===e||null===(t=e.app)||void 0===t?void 0:t.multishipEnabled)??!0,{removeEmptyShipments:m}=(0,Oe.n)(c),{updateItemsToDeliveryShipment:g}=(0,Ge.A)(null==c?void 0:c.basketId),f=(0,ne.F_)(c),h=null==f?void 0:f.shippingAddress,y=(null==h?void 0:h.address1)&&(null==h?void 0:h.city),v=((null==c||null===(r=c.productItems)||void 0===r?void 0:r.length)||0)>1,E=(null==c||null===(i=c.shipments)||void 0===i?void 0:i.filter(e=>!(0,ne.f_)(e)))||[],A=E.length>1,[S,I]=(0,s.useState)(A),{isOpen:O,onOpen:w,onClose:P}=(0,ue.j)(),[C,k]=(0,s.useState)(!1),{step:x,STEPS:j,goToStep:T}=(0,b.Q)(),z=(0,q.useShopperCustomersMutation)("createCustomerAddress"),R=(0,q.useShopperCustomersMutation)("updateCustomerAddress"),B=(0,q.useShopperBasketsMutation)("updateShippingAddressForShipment"),L=(0,ge.d)();(0,s.useEffect)(()=>{I(A)},[A]);const $=function(){var e=(0,n.A)(function*(e){d(!0);try{var t;const{addressId:r}=e,n=(0,ne.F_)(c),s=(null==n?void 0:n.shipmentId)||G.zQ;let a=null;if(yield B.mutateAsync({parameters:{basketId:c.basketId,shipmentId:s,useAsBilling:!1},body:(0,ve.Nr)(e)}),u.isRegistered&&!r){const t=Ye(Ye({},(0,ve.ux)(e)),{},{addressId:(0,oe.Ak)()});yield z.mutateAsync({body:t,parameters:{customerId:u.customerId}})}u.isRegistered&&r&&(yield R.mutateAsync({body:e,parameters:{customerId:u.customerId,addressName:r}}));const i=((null==c||null===(t=c.productItems)||void 0===t?void 0:t.filter(e=>E.some(t=>t.shipmentId===e.shipmentId)))||[]).filter(e=>e.shipmentId!==s);i.length>0&&(a=yield g(i,s)),yield m(a||c),T(j.SHIPPING_OPTIONS)}catch(e){L({title:l({defaultMessage:[{type:0,value:"Something went wrong while updating the shipping address. Try again."}],id:"shipping_address.error.update_failed"}),status:"error"})}finally{d(!1)}});return function(t){return e.apply(this,arguments)}}(),W=x===j.SHIPPING_ADDRESS;return s.createElement(s.Fragment,null,s.createElement(M.Le,{id:"step-1",title:l({defaultMessage:[{type:0,value:"Shipping Address"}],id:"shipping_address.title.shipping_address"}),editing:W,isLoading:o,disabled:x===j.CONTACT_INFO&&!h,onEdit:()=>T(j.SHIPPING_ADDRESS),editLabel:l(S?{defaultMessage:[{type:0,value:"Edit Shipping Addresses"}],id:"toggle_card.action.editShippingAddresses"}:{defaultMessage:[{type:0,value:"Edit Shipping Address"}],id:"toggle_card.action.editShippingAddress"}),editAction:p&&v?l(S?tt:rt):null,onEditActionClick:p&&v?()=>{S&&null!=u&&u.isGuest&&C?w():I(!S)}:null},s.createElement(M.hl,null,S?s.createElement($e,{basket:c,submitButtonLabel:Je,noItemsInBasketMessage:et,onUnsavedGuestAddressesToggleWarning:e=>{k(e)}}):s.createElement(ce.A,{selectedAddress:h,submitButtonLabel:Je,onSubmit:$,formTitleAriaLabel:Ze})),y&&s.createElement(M.vr,null,A?s.createElement(_.E,null,l({defaultMessage:[{type:0,value:"Your items will be shipped to multiple addresses."}],id:"shipping_address.summary.multiple_addresses"})):s.createElement(pe.A,{address:h}))),s.createElement(Qe,{isOpen:O,onClose:P,onConfirm:()=>{I(!1),P()},onCancel:()=>{P()}}))}function st(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function at(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?st(Object(r),!0).forEach(function(t){(0,U.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):st(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const it=({shipment:e,basket:t})=>{var r;const{currency:n}=(0,re.H2)(),a=(null==t||null===(r=t.productItems)||void 0===r?void 0:r.filter(t=>t.shipmentId===e.shipmentId))||[],o=a.map(e=>e.productId).filter(Boolean).join(","),{data:d,isLoading:u}=(0,q.useProducts)({parameters:{ids:o,allImages:!0}},{enabled:Boolean(o),select:e=>{var t;return(null==e||null===(t=e.data)||void 0===t?void 0:t.reduce((e,t)=>(e[t.id]=t,e),{}))||{}}});return u?s.createElement(l.az,{display:"flex",justifyContent:"center",alignItems:"center",py:8},s.createElement(ke.A,null)):s.createElement(he.T,{spacing:4,align:"stretch"},a.map(e=>{const t=(null==d?void 0:d[e.productId])||{},r=at(at({},e),t);return s.createElement(Q.A,{key:e.itemId,variant:r},s.createElement(l.az,{border:"1px solid",borderColor:"gray.200",borderRadius:"md",p:3,bg:"white",mb:2},s.createElement(K.s,{width:"full",alignItems:"flex-start"},s.createElement(X.A,{width:["88px","136px"],mr:4}),s.createElement(p.B,{spacing:1,marginTop:"-3px",flex:1},s.createElement(Y.A,null),s.createElement(J.A,{includeQuantity:!1,hideAttributeLabels:!0}),s.createElement(K.s,{width:"full",justifyContent:"space-between",alignItems:"flex-end"},s.createElement(_.E,{fontSize:"sm",color:"gray.700"},s.createElement(i.A,{defaultMessage:[{type:0,value:"Qty: "},{type:1,value:"quantity"}],values:{quantity:e.quantity},id:"item_attributes.label.quantity_abbreviated"})),s.createElement(Z.A,{currency:n}))))))}))};it.propTypes={shipment:E().shape({shipmentId:E().string.isRequired}).isRequired,basket:E().shape({productItems:E().arrayOf(E().shape({itemId:E().string.isRequired,shipmentId:E().string,productName:E().string,image:E().string,imageUrl:E().string,primaryImage:E().string,images:E().array,quantity:E().number,variationValues:E().object,variations:E().object}))}).isRequired};const lt=it;var ot=r(12619),dt=r(95170);const ut=({shipment:e,basketId:t,currency:r,control:n})=>{var i,o,d;const{formatMessage:u}=(0,a.A)(),c=(null===(i=(0,F.getConfig)())||void 0===i||null===(o=i.app)||void 0===o?void 0:o.storeLocatorEnabled)??G.mP,{data:m,isLoading:g}=(0,q.useShippingMethodsForShipment)({parameters:{basketId:t,shipmentId:e.shipmentId}},{enabled:Boolean(t&&e.shipmentId&&e.shippingAddress)});if(!e.shippingAddress)return null;const f=`shippingMethodId_${e.shipmentId}`,h=c?(null==m||null===(d=m.applicableShippingMethods)||void 0===d?void 0:d.filter(e=>!e.c_storePickupEnabled))||[]:(null==m?void 0:m.applicableShippingMethods)||[];return s.createElement(he.T,{spacing:6,align:"stretch"},s.createElement(l.az,{pt:2,pb:6,px:2},g?s.createElement(l.az,{display:"flex",justifyContent:"center",alignItems:"center",py:8},s.createElement(ke.A,null)):h.length>0&&s.createElement(l.az,{px:4},s.createElement(P.xI,{name:f,control:n,defaultValue:"",rules:{required:!0},render:({field:t})=>s.createElement(ot.z,(0,y.A)({},t,{name:`shipping-options-radiogroup-${e.shipmentId}`}),s.createElement(p.B,{spacing:2},h.map(e=>s.createElement(dt.s,{value:e.id,key:e.id},s.createElement(l.az,{w:"full"},s.createElement(K.s,{justify:"space-between",w:"full",align:"flex-start"},s.createElement(l.az,{flex:1},s.createElement(_.E,{fontSize:"sm",fontWeight:"medium"},e.name),s.createElement(_.E,{fontSize:"xs",color:"gray.600",mt:.5},e.description)),s.createElement(l.az,{fontWeight:"bold",fontSize:"sm",ml:2},0===e.price?s.createElement(_.E,{color:"green.600"},u({defaultMessage:[{type:0,value:"Free"}],id:"shipping_options.free"})):s.createElement(de.Gr,{value:e.price,style:"currency",currency:r}))),e.shippingPromotions&&e.shippingPromotions.length>0&&s.createElement(he.T,{spacing:.5,mt:1,align:"flex-start"},e.shippingPromotions.map(e=>s.createElement(_.E,{key:e.promotionId,fontSize:"xs",color:"green.600"},e.calloutMsg))))))))}))))};ut.propTypes={shipment:E().shape({shipmentId:E().string.isRequired,shippingAddress:E().shape({firstName:E().string,lastName:E().string,address1:E().string,city:E().string,stateCode:E().string,postalCode:E().string}),shippingMethod:E().shape({id:E().string})}).isRequired,basketId:E().string.isRequired,currency:E().string.isRequired,control:E().object.isRequired};const ct=ut,pt=({shipment:e,basketId:t,currency:r,control:n,basket:i})=>{const{formatMessage:o}=(0,a.A)();return e.shippingAddress?s.createElement(he.T,{spacing:6,align:"stretch"},s.createElement(l.az,null,s.createElement(_.E,{fontWeight:"bold",fontSize:"md",mb:1},o({defaultMessage:[{type:0,value:"Shipping to "},{type:1,value:"name"}],id:"shipping_options.label.shipping_to"},{name:`${e.shippingAddress.firstName} ${e.shippingAddress.lastName}`})),s.createElement(_.E,{fontSize:"sm",color:"gray.600"},e.shippingAddress.address1,", ",e.shippingAddress.city,","," ",e.shippingAddress.stateCode," ",e.shippingAddress.postalCode)),s.createElement(l.az,{border:"1px solid",borderColor:"gray.200",borderRadius:"lg",pt:2,pb:4,px:2,bg:"white"},s.createElement(he.T,{spacing:4,align:"stretch"},s.createElement(lt,{shipment:e,basket:i}),s.createElement(ct,{shipment:e,basketId:t,currency:r,control:n})))):null};function mt(){const{formatMessage:e}=(0,a.A)(),{step:t,STEPS:r,goToStep:o,goToNextStep:u}=(0,b.Q)(),{data:c,derivedData:{totalShippingCost:m},isLoading:g}=(0,D.X)(),{currency:h}=(0,re.H2)(),y=(0,q.useShopperBasketsMutation)("updateShippingMethodForShipment"),{data:v}=(0,q.useShippingMethodsForShipment)({parameters:{basketId:null==c?void 0:c.basketId,shipmentId:"me"}},{enabled:Boolean(null==c?void 0:c.basketId)&&t===r.SHIPPING_OPTIONS}),E=c&&c.shipments&&c.shipments.filter(e=>e.shippingAddress&&!(0,ne.f_)(e))||[],A=E.length>1,S=()=>{const e={};return E.forEach(t=>{e[`shippingMethodId_${t.shipmentId}`]=t.shippingMethod&&t.shippingMethod.id||(null==v?void 0:v.defaultShippingMethodId)||""}),e},I=(0,P.mN)({mode:"onChange",defaultValues:S()});(0,s.useEffect)(()=>{const e=I.getValues(),t=S();Object.keys(t).some(t=>!(t in e)||""===e[t])&&(I.reset(t),E.forEach(function(){var e=(0,n.A)(function*(e){const r=t[`shippingMethodId_${e.shipmentId}`],n=e.shippingMethod&&e.shippingMethod.id;if(r&&!n&&r===(null==v?void 0:v.defaultShippingMethodId))try{yield y.mutateAsync({parameters:{basketId:c.basketId,shipmentId:e.shipmentId},body:{id:r}})}catch(e){console.warn(e)}});return function(t){return e.apply(this,arguments)}}()))},[E.length,null==v?void 0:v.defaultShippingMethodId]);const O=function(){var e=(0,n.A)(function*(e){const t=E.map(t=>{const r=e[`shippingMethodId_${t.shipmentId}`];return r?y.mutateAsync({parameters:{basketId:c.basketId,shipmentId:t.shipmentId},body:{id:r}}):Promise.resolve()});yield Promise.all(t),u()});return function(t){return e.apply(this,arguments)}}(),w=e({defaultMessage:[{type:0,value:"Free"}],id:"checkout_confirmation.label.free"}),C=E.length>0&&E.every(e=>e.shippingAddress),k=I.formState.isValid||E.every(e=>e.shippingMethod&&e.shippingMethod.id);return g?s.createElement(M.Le,{id:"step-2",title:e({defaultMessage:[{type:0,value:"Shipping & Gift Options"}],id:"shipping_options.title.shipping_gift_options"}),editing:t===r.SHIPPING_OPTIONS,isLoading:!0,disabled:!0,onEdit:()=>o(r.SHIPPING_OPTIONS),editLabel:e({defaultMessage:[{type:0,value:"Edit Shipping Options"}],id:"toggle_card.action.editShippingOptions"})},s.createElement(M.hl,null,s.createElement(l.az,{display:"flex",justifyContent:"center",alignItems:"center",minH:"200px"},s.createElement(ke.A,null)))):s.createElement(M.Le,{id:"step-2",title:e({defaultMessage:[{type:0,value:"Shipping & Gift Options"}],id:"shipping_options.title.shipping_gift_options"}),editing:t===r.SHIPPING_OPTIONS,isLoading:I.formState.isSubmitting,disabled:!C,onEdit:()=>o(r.SHIPPING_OPTIONS),editLabel:e({defaultMessage:[{type:0,value:"Edit Shipping Options"}],id:"toggle_card.action.editShippingOptions"})},s.createElement(M.hl,null,s.createElement("form",{onSubmit:I.handleSubmit(O),"data-testid":"sf-checkout-shipping-options-form"},s.createElement(p.B,{spacing:6},E.map(e=>s.createElement(l.az,{key:e.shipmentId},A?s.createElement(pt,{shipment:e,basketId:c.basketId,currency:h,control:I.control,basket:c}):s.createElement(ct,{shipment:e,basketId:c.basketId,currency:h,control:I.control}))),s.createElement(l.az,null,s.createElement(d.m,{variant:"form"},s.createElement(f.$,{w:"full",type:"submit",isDisabled:!k},s.createElement(i.A,{defaultMessage:[{type:0,value:"Continue to Payment"}],id:"shipping_options.button.continue_to_payment"}))))))),C&&s.createElement(M.vr,null,1===E.length?s.createElement(l.az,null,E[0].shippingMethod&&s.createElement(s.Fragment,null,s.createElement(K.s,{justify:"space-between",w:"full"},s.createElement(_.E,null,E[0].shippingMethod.name),s.createElement(_.E,{fontWeight:"bold"},0===m?w:s.createElement(de.Gr,{value:m,style:"currency",currency:h}))),s.createElement(_.E,{fontSize:"sm",color:"gray.700"},E[0].shippingMethod.description))):s.createElement(p.B,{spacing:2},E.map(t=>{const r=t.shippingTotal||0;return s.createElement(l.az,{key:t.shipmentId},s.createElement(K.s,{justify:"space-between",w:"full"},s.createElement(l.az,{flex:"1"},t.shippingMethod?s.createElement(s.Fragment,null,s.createElement(_.E,{mt:2},t.shippingMethod.name),s.createElement(_.E,{fontSize:"sm",color:"gray.700"},t.shippingMethod.description)):s.createElement(_.E,{mt:2,fontSize:"sm",color:"gray.500"},e({defaultMessage:[{type:0,value:"No shipping method selected"}],id:"shipping_options.label.no_method_selected"}))),s.createElement(_.E,{fontWeight:"bold",fontSize:"sm"},0===r?w:s.createElement(de.Gr,{value:r,style:"currency",currency:h}))))}),E.length>1&&s.createElement(l.az,{borderTopWidth:"1px",pt:2,mt:2},s.createElement(K.s,{justify:"space-between",w:"full"},s.createElement(_.E,{fontWeight:"semibold"},e({defaultMessage:[{type:0,value:"Total Shipping"}],id:"shipping_options.label.total_shipping"})),s.createElement(_.E,{fontWeight:"bold"},s.createElement(de.Gr,{value:m,style:"currency",currency:h})))))))}pt.propTypes={shipment:E().shape({shipmentId:E().string.isRequired,shippingAddress:E().shape({firstName:E().string,lastName:E().string,address1:E().string,city:E().string,stateCode:E().string,postalCode:E().string}),shippingMethod:E().shape({id:E().string})}).isRequired,basketId:E().string.isRequired,currency:E().string.isRequired,control:E().object.isRequired,basket:E().shape({productItems:E().arrayOf(E().shape({itemId:E().string.isRequired,shipmentId:E().string,productName:E().string,image:E().string,imageUrl:E().string,primaryImage:E().string,images:E().array,quantity:E().number,variationValues:E().object,variations:E().object}))}).isRequired};var gt=r(98018),ft=r(535),ht=r(25109);const bt=()=>s.createElement(l.az,{background:"gray.50",flex:"1"},s.createElement(d.m,{"data-testid":"sf-checkout-skeleton",maxWidth:"container.xl",py:{base:7,lg:16},px:{base:0,lg:4}},s.createElement(u.x,{templateColumns:{base:"1fr",lg:"66% 1fr"},gap:{base:10,lg:20}},s.createElement(c.E,null,s.createElement(p.B,{spacing:4},s.createElement(ht.E,{height:"78px"}),s.createElement(ht.E,{height:"78px"}),s.createElement(ht.E,{height:"78px"}),s.createElement(ht.E,{height:"78px"}))),s.createElement(c.E,{py:6,px:[4,4,0]},s.createElement(p.B,{spacing:5},s.createElement(ht.E,{height:"30px",width:"50%"}),s.createElement(p.B,{spacing:5},s.createElement(ht.E,{height:"30px",width:"65%"}),s.createElement(p.B,{w:"full",py:4,borderY:"1px",borderColor:"gray.200"},s.createElement(ht.E,{height:6}),s.createElement(ht.E,{height:6}),s.createElement(ht.E,{height:6})),s.createElement(ht.E,{height:6})))))));var yt=r(71878),vt=r(54550);const Et=({children:e})=>{const{configurations:t}=(0,b.Q)(),r=function(e){var t,r,n,s,a;return(null===(t=(0,F.getConfig)())||void 0===t||null===(r=t.app)||void 0===r||null===(n=r.googleCloudAPI)||void 0===n?void 0:n.apiKey)||(null==e||null===(s=e.configurations)||void 0===s||null===(a=s.find(e=>"gcp"===e.id))||void 0===a?void 0:a.value)}(t);return r?s.createElement(vt.c4,{apiKey:r},e):e};Et.propTypes={googleCloudAPIKey:E().string,children:E().node.isRequired};const _t=()=>{var e,t;const{formatMessage:r}=(0,a.A)(),y=(0,h.A)(),{step:v}=(0,b.Q)(),[E,_]=(0,s.useState)(),{data:A,derivedData:S}=(0,D.X)(),[I,O]=(0,s.useState)(!1),{mutateAsync:w}=(0,q.useShopperOrdersMutation)("createOrder"),{passwordless:P={},social:C={}}=(0,F.getConfig)().app.login||{},M=null==C?void 0:C.idps,k=!(null==C||!C.enabled),x=!(null==P||!P.enabled),{removeEmptyShipments:j}=(0,Oe.n)(A),T=((null===(e=(0,F.getConfig)())||void 0===e||null===(t=e.app)||void 0===t?void 0:t.multishipEnabled)??!0)&&(null==S?void 0:S.totalPickupShipments)>0&&(null==S?void 0:S.totalDeliveryShipments)>0,z=(null==S?void 0:S.totalPickupShipments)>0,R=!T&&z;(0,s.useEffect)(()=>{(E||4===v)&&window.scrollTo({top:0})},[E,v]),(0,s.useEffect)(()=>{var e;(null==A||null===(e=A.shipments)||void 0===e?void 0:e.length)>1&&j(A)},[null==A?void 0:A.basketId]);const N=function(){var e=(0,n.A)(function*(){O(!0);try{const e=yield w({body:{basketId:A.basketId}});y(`/checkout/confirmation/${e.orderNo}`)}catch(e){const t=r({id:"checkout.message.generic_error",defaultMessage:[{type:0,value:"An unexpected error occurred during checkout."}]});_(t)}finally{O(!1)}});return function(){return e.apply(this,arguments)}}();return s.createElement(l.az,{background:"gray.50",flex:"1"},s.createElement(o.D,{as:"h1",fontSize:"2xl",mb:6,textAlign:"center"},s.createElement(i.A,{defaultMessage:[{type:0,value:"Checkout"}],id:"checkout.title.checkout"})),s.createElement(d.m,{"data-testid":"sf-checkout-container",maxWidth:"container.xl",py:{base:7,lg:16},px:{base:0,lg:8}},s.createElement(u.x,{templateColumns:{base:"1fr",lg:"66% 1fr"},gap:{base:10,xl:20}},s.createElement(c.E,null,s.createElement(p.B,{spacing:4},E&&s.createElement(m.F,{status:"error",variant:"left-accent"},s.createElement(g._,null),E),s.createElement(V,{isSocialEnabled:k,isPasswordlessEnabled:x,idps:M}),R?s.createElement(le,null):s.createElement(s.Fragment,null,z&&s.createElement(le,null),s.createElement(nt,null),s.createElement(mt,null)),s.createElement(gt.A,null),5===v&&s.createElement(l.az,{pt:3,display:{base:"none",lg:"block"}},s.createElement(d.m,{variant:"form"},s.createElement(f.$,{w:"full",onClick:N,isLoading:I,"data-testid":"sf-checkout-place-order-btn"},s.createElement(i.A,{defaultMessage:[{type:0,value:"Place Order"}],id:"checkout.button.place_order"})))))),s.createElement(c.E,{py:6,px:[4,4,4,0]},s.createElement(ft.A,{basket:A,showTaxEstimationForm:!1,showCartItems:!0}),5===v&&s.createElement(l.az,{display:{base:"none",lg:"block"},pt:2},s.createElement(f.$,{w:"full",onClick:N,isLoading:I},s.createElement(i.A,{defaultMessage:[{type:0,value:"Place Order"}],id:"checkout.button.place_order"})))))),5===v&&s.createElement(l.az,{display:{lg:"none"},position:"sticky",bottom:"0",px:4,pt:6,pb:11,background:"white",borderTop:"1px solid",borderColor:"gray.100"},s.createElement(d.m,{variant:"form"},s.createElement(f.$,{w:"full",onClick:N,isLoading:I},s.createElement(i.A,{defaultMessage:[{type:0,value:"Place Order"}],id:"checkout.button.place_order"})))))},At=()=>{const{data:e}=(0,N.J)(),{data:t}=(0,D.X)(),{formatMessage:r}=(0,a.A)(),i=(0,q.useShopperBasketsMutation)("removeItemFromBasket"),l=(0,ge.d)(),[o,d]=(0,s.useState)(!1),u=function(){var e=(0,n.A)(function*(e){yield i.mutateAsync({parameters:{basketId:t.basketId,itemId:e.itemId}},{onSuccess:()=>{l({title:r(G.Tq,{quantity:1}),status:"success"})},onError:()=>{l({title:r(G.gS),status:"error"})}})});return function(t){return e.apply(this,arguments)}}(),c=function(){var e=(0,n.A)(function*(e){var r;d(!0);const n=null==t||null===(r=t.productItems)||void 0===r?void 0:r.filter(t=>null==e?void 0:e.includes(t.productId));for(let e of n)yield u(e);d(!1)});return function(t){return e.apply(this,arguments)}}();return e&&e.customerId&&t&&t.basketId?s.createElement(b.s,null,o&&s.createElement(ke.A,{wrapperStyles:{height:"100vh"}}),s.createElement(Et,null,s.createElement(_t,null)),s.createElement(yt.A,{productItems:null==t?void 0:t.productItems,handleUnavailableProducts:c})):s.createElement(bt,null)}},63484(e,t,r){r.d(t,{A:()=>$});var n=r(18801),s=r(10939),a=r(28407),i=r(64180),l=r(77810),o=r(75826),d=r.n(o),u=r(16602),c=r(34692),p=r(41863),m=r(62539),g=r(92519),f=r(91311),h=r(79237),b=r(95266),y=r(17778),v=r(49785),E=r(17015),_=r(86945),A=r(45437),S=r(35490);const I=l.createContext(),O=e=>{const t=l.useContext(I),{getInputProps:r,getRadioProps:n}=(0,_.z)(t(e)),s=r(),a=n();return l.createElement(m.az,{as:"label"},l.createElement("input",s),l.createElement(m.az,(0,i.A)({},a,{"aria-hidden":!1,position:"relative",cursor:"pointer",border:"1px solid",borderColor:"gray.200",borderRadius:"base",height:"full",_checked:{borderColor:"blue.600"},_focus:{boxShadow:"outline"},px:4,py:4}),s.checked&&l.createElement(m.az,{position:"absolute",top:0,right:0,w:0,h:0,borderStyle:"solid",borderWidth:"0 38px 38px 0",borderColor:"transparent",borderRightColor:"blue.600"},l.createElement(S.Sr,{color:"white",position:"absolute",right:"-40px",top:"1px"})),e.children))},w=e=>{const{getRootProps:t,getRadioProps:r}=(0,A.m)(e),n=t();return l.createElement(I.Provider,{value:r},l.createElement(m.az,n,e.children))};O.propTypes={children:d().any},w.propTypes={children:d().any};var P=r(44013),C=r(73437),M=r(16256),k=r(81916),x=r(8426),j=r(60309),T=r(90031);const z=["addressId","creationDate","lastModified","preferred"],R=["id","_type"];function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach(function(t){(0,s.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const B=(0,u.zR)({defaultMessage:[{type:0,value:"Save & Continue to Shipping Method"}],id:"shipping_address_edit_form.button.save_and_continue"}),L=({title:e,hasSavedAddresses:t,toggleAddressEdit:r,hideSubmitButton:n,form:s,submitButtonLabel:a,formTitleAriaLabel:o,isBillingAddress:d=!1})=>{const{formatMessage:u}=(0,c.A)();return l.createElement(m.az,(0,i.A)({},t&&!d&&{gridColumn:[1,1,"span 2"],paddingX:[4,4,6],paddingY:6,rounded:"base",border:"1px solid",borderColor:"blue.600"},{"data-testid":"sf-shipping-address-edit-form"}),l.createElement(g.B,{spacing:6},t&&!d&&l.createElement(f.D,{as:"h3",size:"sm"},e),l.createElement(g.B,{spacing:6},l.createElement(M.A,{form:s,formTitleAriaLabel:o,isBillingAddress:d}),t&&!n?l.createElement(k.A,{saveButtonLabel:B,onCancel:r}):!n&&l.createElement(m.az,null,l.createElement(h.m,{variant:"form"},l.createElement(b.$,{type:"submit",width:"full",disabled:s.formState.isSubmitting},u(a)))))))};L.propTypes={title:d().string,hasSavedAddresses:d().bool,toggleAddressEdit:d().func,hideSubmitButton:d().bool,form:d().object,submitButtonLabel:x.O2,formTitleAriaLabel:x.O2,isBillingAddress:d().bool};const q=(0,u.zR)({defaultMessage:[{type:0,value:"Submit"}],id:"shipping_address_selection.button.submit"}),F=({form:e,selectedAddress:t,submitButtonLabel:r=q,formTitleAriaLabel:s,hideSubmitButton:i=!1,onSubmit:o=(0,a.A)(function*(){return null}),isBillingAddress:d=!1})=>{var u;const{formatMessage:f}=(0,c.A)(),{data:_,isLoading:A,isFetching:I}=(0,j.J)(),M=A&&I,k=(null===(u=_.addresses)||void 0===u?void 0:u.length)>0,[x,N]=(0,l.useState)(!1),[B,F]=(0,l.useState)(void 0),[$,G]=(0,l.useState)({});(0,l.useEffect)(()=>{var e;const t={};null===(e=_.addresses)||void 0===e||e.forEach(({addressId:e})=>{t[e]=l.createRef()}),G(t)},[_.addresses]);const W=(0,v.mN)({mode:"onChange",shouldUnregister:!1,defaultValues:D({},t)});e||(e=W);const H=k&&t&&_.addresses.find(e=>{const{addressId:r,creationDate:s,lastModified:a,preferred:i}=e,l=(0,n.A)(e,z),{id:o,_type:d}=t,u=(0,n.A)(t,R);return(0,E.Gh)(l,u)}),V=(0,T.useShopperCustomersMutation)("removeCustomerAddress");(0,l.useEffect)(()=>{if(d)e.reset(D({},t));else if(_.addresses){const t=_.addresses.find(e=>!0===e.preferred);t&&(e.reset(D({},t)),F(t.addressId))}},[]),(0,l.useEffect)(()=>{var e;A||null!=_&&null!==(e=_.addresses)&&void 0!==e&&e.length||x||N(!0)},[_]),(0,l.useEffect)(()=>{H&&(e.reset(D({addressId:H.addressId},H)),F(H.addressId))},[H]);const U=function(){var t=(0,a.A)(function*(t){B&&(t=D(D({},t),{},{addressId:B})),N(!1),e.reset({addressId:""}),yield o(t)});return function(e){return t.apply(this,arguments)}}(),K=t=>{t&&x&&N(!1),F(t);const r=_.addresses.find(e=>e.addressId===t);e.reset(D({},r))},Q=f({defaultMessage:[{type:0,value:"Shipping Address"}],id:"shipping_address.title.shipping_address"}),X=Array.from(document.querySelectorAll("h2")).find(e=>e.textContent===Q),Y=function(){var t=(0,a.A)(function*(t){t===B&&(F(void 0),N(!1),e.reset({addressId:""})),yield V.mutateAsync({parameters:{customerId:_.customerId,addressName:t}},{onSuccess:()=>{null==X||X.focus()}})});return function(e){return t.apply(this,arguments)}}(),J=(t=void 0)=>{if(null!=t&&t.addressId)F(t.addressId),e.reset(D({},t)),N(!0);else{var r;const t=(null===(r=$[B])||void 0===r?void 0:r.current)??X;null==t||t.focus(),F(void 0),e.reset({addressId:""}),N(!x)}e.trigger()};return M?null:l.createElement("form",{onSubmit:e.handleSubmit(U)},l.createElement(g.B,{spacing:4},k&&!d&&l.createElement(v.xI,{name:"addressId",defaultValue:"",control:e.control,rules:{required:!x},render:({field:{value:t}})=>{var n;return l.createElement(w,{value:t,onChange:K},l.createElement(y.r,{columns:[1,1,2],spacing:4,gridAutoFlow:"row dense"},null===(n=_.addresses)||void 0===n?void 0:n.map((t,n)=>{const a=f({defaultMessage:[{type:0,value:"Edit "},{type:1,value:"address"}],id:"shipping_address.label.edit_button"},{address:t.address1}),o=f({defaultMessage:[{type:0,value:"Remove "},{type:1,value:"address"}],id:"shipping_address.label.remove_button"},{address:t.address1});return l.createElement(l.Fragment,{key:t.addressId},l.createElement(O,{value:t.addressId},l.createElement(P.A,{padding:0,border:"none",onRemove:()=>Y(t.addressId),onEdit:()=>J(t),editBtnRef:$[t.addressId],"data-testid":`sf-checkout-shipping-address-${n}`,editBtnLabel:a,removeBtnLabel:o},l.createElement(C.A,{address:t})),x&&t.addressId===B&&l.createElement(m.az,{width:3,height:3,borderLeft:"1px solid",borderTop:"1px solid",borderColor:"blue.600",position:"absolute",left:"50%",bottom:"-23px",background:"white",transform:"rotate(45deg)"})),x&&t.addressId===B&&l.createElement(L,{title:f({defaultMessage:[{type:0,value:"Edit Shipping Address"}],id:"shipping_address_selection.title.edit_shipping"}),hasSavedAddresses:k,toggleAddressEdit:J,hideSubmitButton:i,form:e,submitButtonLabel:r,formTitleAriaLabel:s}))}),l.createElement(b.$,{variant:"outline",border:"1px dashed",borderColor:"gray.200",color:"blue.600",height:["44px","44px","167px"],rounded:"base",fontWeight:"medium",leftIcon:l.createElement(S.c1,{boxSize:"15px"}),onClick:J},l.createElement(p.A,{defaultMessage:[{type:0,value:"Add New Address"}],id:"shipping_address_selection.button.add_address"}),x&&!B&&l.createElement(m.az,{width:3,height:3,borderLeft:"1px solid",borderTop:"1px solid",borderColor:"blue.600",position:"absolute",left:"50%",bottom:"-23px",background:"white",transform:"rotate(45deg)"}))))}}),((null==_?void 0:_.isGuest)||x&&!B||d)&&l.createElement(L,{title:f({defaultMessage:[{type:0,value:"Add New Address"}],id:"shipping_address_selection.title.add_address"}),hasSavedAddresses:k,toggleAddressEdit:J,hideSubmitButton:i,form:e,isBillingAddress:d,submitButtonLabel:r,formTitleAriaLabel:s}),_.isRegistered&&!x&&!i&&l.createElement(m.az,{pt:2},l.createElement(h.m,{variant:"form"},l.createElement(b.$,{type:"submit",width:"full",disabled:!e.formState.isValid||e.formState.isSubmitting||!B},f(r))))))};F.propTypes={form:d().object,selectedAddress:d().object,submitButtonLabel:x.O2,formTitleAriaLabel:x.O2,hideSubmitButton:d().bool,onSubmit:d().func,isBillingAddress:d().bool};const $=F},77167(e,t,r){r.d(t,{Q:()=>b,s:()=>h});var n=r(10939),s=r(77810),a=r(75826),i=r.n(a),l=r(65376),o=r(60309),d=r(84319),u=r(73448),c=r(4026),p=r(90031);function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach(function(t){(0,n.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const f=s.createContext(),h=({children:e})=>{var t,r,n;const{data:a}=(0,o.J)(),{data:i,derivedData:m,isLoading:h}=(0,d.X)(),{data:b}=(0,p.useConfigurations)(),y=(0,l.A)(),[v,E]=(0,s.useState)(),_=(null===(t=(0,c.getConfig)())||void 0===t||null===(r=t.app)||void 0===r?void 0:r.storeLocatorEnabled)??u.mP,A=["CONTACT_INFO","PICKUP_ADDRESS","SHIPPING_ADDRESS","SHIPPING_OPTIONS","PAYMENT","REVIEW_ORDER"],S=A.reduce((e,t,r)=>g(g({},e),{},{[t]:r}),{});(0,s.useEffect)(()=>{var e;if(h||!a||!i)return;let t=S.REVIEW_ORDER;!a.isGuest||null!==(e=i.customerInfo)&&void 0!==e&&e.email?null!=m&&m.isMissingShippingAddress?t=S.SHIPPING_ADDRESS:null!=m&&m.isMissingShippingMethod?t=S.SHIPPING_OPTIONS:i.paymentInstruments&&i.billingAddress||(t=S.PAYMENT):t=S.CONTACT_INFO,E(t)},[h,null==a?void 0:a.isGuest,null==i||null===(n=i.customerInfo)||void 0===n?void 0:n.email,null==i?void 0:i.shipments,null==i?void 0:i.paymentInstruments,null==i?void 0:i.billingAddress,null==m?void 0:m.isMissingShippingAddress,null==m?void 0:m.isMissingShippingMethod]),(0,s.useEffect)(()=>{null!=i&&i.productItems&&y.sendBeginCheckout(i)},[]),(0,s.useEffect)(()=>{null!=v&&y.sendCheckoutStep((e=>A[e])(v),v,i)},[v]);const I={step:v,STEPS:S,goToNextStep:()=>{if(v===S.CONTACT_INFO){if(0===(null==m?void 0:m.totalDeliveryShipments)&&1===(null==m?void 0:m.totalPickupShipments))return void E(S.PAYMENT);const e=_&&(null==m?void 0:m.totalPickupShipments)>0;E(e?S.PICKUP_ADDRESS:S.SHIPPING_ADDRESS)}else if(v===S.PICKUP_ADDRESS){const e=(null==m?void 0:m.totalDeliveryShipments)>0;E(e?S.SHIPPING_ADDRESS:S.PAYMENT)}else E(v+1)},goToStep:e=>E(e),configurations:b};return s.createElement(f.Provider,{value:I},e)};h.propTypes={children:i().any};const b=()=>s.useContext(f)}}]);