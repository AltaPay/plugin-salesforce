"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[729],{54997(e,t,s){s.r(t),s.d(t,{default:()=>P});var a=s(28407),r=s(77810),n=s(75826),o=s.n(n),i=s(16602),l=s(34692),u=s(41863),c=s(91311),d=s(62539),p=s(79237),m=s(90031),g=s(7711),f=s(41375),y=s(49785),h=s(64965),A=s(65376),E=s(17492),w=s(68614),b=s(69422),v=s(73448),S=s(94012),_=s(17015),C=s(4026);const k=(0,i.zR)({defaultMessage:[{type:0,value:"Incorrect username or password, please try again."}],id:"login_page.error.incorrect_username_or_password"}),L="login",B="email",D=({initialView:e=L})=>{const{formatMessage:t}=(0,l.A)(),s=(0,g.A)(),n=(0,y.mN)(),o=(0,h.zy)(),i=new URLSearchParams(o.search),{path:D}=(0,h.W5)(),P=(0,A.A)(),H=(0,E.A)(),{isRegistered:T,customerType:U}=(0,m.useCustomerType)(),I=(0,m.useAuthHelper)(m.AuthHelpers.LoginRegisteredUserB2C),R=(0,m.useAuthHelper)(m.AuthHelpers.LoginPasswordlessUser),O=(0,m.useAuthHelper)(m.AuthHelpers.AuthorizePasswordless),{passwordless:z={},social:F={}}=(0,C.getConfig)().app.login||{},j=!(null==z||!z.enabled),M=!(null==F||!F.enabled),N=null==F?void 0:F.idps,V=(0,m.useCustomerId)(),K=(0,S.Z)(U),{data:W,isSuccess:x}=(0,m.useCustomerBaskets)({parameters:{customerId:V}},{enabled:!!V&&!_.S$,keepPreviousData:!0}),Q=(0,m.useShopperBasketsMutation)("mergeBasket"),[Z,$]=(0,r.useState)(e),[q,G]=(0,r.useState)(""),[J,X]=(0,r.useState)(""),Y=()=>{var e,s,a;if((null==W||null===(e=W.baskets)||void 0===e||null===(s=e[0])||void 0===s||null===(a=s.productItems)||void 0===a?void 0:a.length)>0&&"guest"===K)try{Q.mutate({headers:{"Content-Type":"application/json"},parameters:{createDestinationBasket:!0}})}catch(e){n.setError("global",{type:"manual",message:t(v.gS)})}},ee=function(){var e=(0,a.A)(function*(e){try{yield O.mutateAsync({userid:e}),G(e),$(B)}catch(e){const s=v.Fk.some(t=>t.test(e.message))?t(v.vn):t(v.gS);n.setError("global",{type:"manual",message:s})}});return function(t){return e.apply(this,arguments)}}(),te=function(){var e=(0,a.A)(function*(e,s=!1){return n.clearErrors(),{login:(o=(0,a.A)(function*(e){if(s){const t=e.email;return void(yield ee(t))}try{yield I.mutateAsync({username:e.email,password:e.password})}catch(e){const s=/Unauthorized/i.test(e.message)?t(k):t(v.gS);n.setError("global",{type:"manual",message:s})}Y()}),function(e){return o.apply(this,arguments)}),email:(r=(0,a.A)(function*(){yield ee(q)}),function(){return r.apply(this,arguments)})}[Z](e);var r,o});return function(t){return e.apply(this,arguments)}}();return(0,r.useEffect)(()=>{if(D===v.bW&&x){const e=decodeURIComponent(i.get("token"));i.get("redirect_url")?X(decodeURIComponent(i.get("redirect_url"))):X("");const s=function(){var s=(0,a.A)(function*(){try{yield R.mutateAsync({pwdlessLoginToken:e})}catch(e){var s;const a=yield null===(s=e.response)||void 0===s?void 0:s.json(),r=v.Fn.test(a.message)?t(v.jk):t(v.gS);n.setError("global",{type:"manual",message:r})}});return function(){return s.apply(this,arguments)}}();s()}},[D,x]),(0,r.useEffect)(()=>{T&&(Y(),s(J||"/account"))},[T,J]),(0,r.useEffect)(()=>{P.sendViewPage(o.pathname),H.sendViewPage(o.pathname)},[]),r.createElement(d.az,{"data-testid":"login-page",bg:"gray.50",py:[8,16]},r.createElement(c.D,{as:"h1",srOnly:!0},r.createElement(u.A,{defaultMessage:[{type:0,value:"Sign In"}],id:"login.title.sign_in"})),r.createElement(f.A,{title:"Sign in",description:"Customer sign in"}),r.createElement(p.m,{paddingTop:16,width:["100%","407px"],bg:"white",paddingBottom:14,marginTop:8,marginBottom:8,borderRadius:"base"},!n.formState.isSubmitSuccessful&&Z===L&&r.createElement(w.A,{form:n,submitForm:e=>{const t=j&&!e.password;return te(e,t)},clickCreateAccount:()=>s("/registration"),handlePasswordlessLoginClick:_.lQ,handleForgotPasswordClick:()=>s("/reset-password"),isPasswordlessEnabled:j,isSocialEnabled:M,idps:N}),Z===B&&r.createElement(b.A,{form:n,submitForm:te,email:q})))};D.getTemplateName=()=>"login",D.propTypes={initialView:o().oneOf([L,B]),match:o().object};const P=D}}]);